<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.55.2" />

    
    
    

<title>The Power of Tidy Data • Gordon Shotwell</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The Power of Tidy Data"/>
<meta name="twitter:description" content="Tidy Data Tidy data has become the dominant way of thinking about problems in R. The idea behind tidy data is to develop an ecosystem of R packages which all work around a similar kind of data structure. That way you can easily compose many different tools together to accomplish very complex tasks in an iterative, easy to understand fashion. There are lots of excellent presentations about why this is a great approach but the one I would recommend if you are new to this area is Hadley Wickham’s keynote from the 2017 rstudio conference."/>

<meta property="og:title" content="The Power of Tidy Data" />
<meta property="og:description" content="Tidy Data Tidy data has become the dominant way of thinking about problems in R. The idea behind tidy data is to develop an ecosystem of R packages which all work around a similar kind of data structure. That way you can easily compose many different tools together to accomplish very complex tasks in an iterative, easy to understand fashion. There are lots of excellent presentations about why this is a great approach but the one I would recommend if you are new to this area is Hadley Wickham’s keynote from the 2017 rstudio conference." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/the_power_of_tidy_data/" />
<meta property="article:published_time" content="2017-02-16T21:48:51-07:00"/>
<meta property="article:modified_time" content="2017-02-16T21:48:51-07:00"/><meta property="og:site_name" content="Title" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.6a83d62c39a364f036df4db1ecd564645635d6c7fc182425cb501218fec485f5.css" integrity="sha256-aoPWLDmjZPA2302x7NVkZFY11sf8GCQly1ASGP7EhfU=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="/">Gordon Shotwell</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="/img/hugo.png" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Gordon Shotwell</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/@gshotwell" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/GShotwell" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/gshotwell" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	<a href="mailto:gorgon@shotwell.ca" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 htr3n
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>The Power of Tidy Data</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 16, 2017
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 7 min read
</div>


  </header>
  
  
  <div class="post">
    
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<div id="tidy-data" class="section level3">
<h3>Tidy Data</h3>
<p>Tidy data has become the dominant way of thinking about problems in R. The idea behind tidy data is to develop an <a href="http://tidyverse.org/">ecosystem</a> of R packages which all work around a similar kind of data structure. That way you can easily compose many different tools together to accomplish very complex tasks in an iterative, easy to understand fashion. There are lots of excellent presentations about why this is a great approach but the one I would recommend if you are new to this area is Hadley Wickham’s <a href="https://www.rstudio.com/resources/videos/data-science-in-the-tidyverse/">keynote</a> from the 2017 rstudio conference.</p>
<p>One problem with data analysis is that you often need to make critical decisions before you really understand the problem. Since data analysis is always somewhat exploratory you can often make some bad decisions in the early stages of your analysis which can cause lots of problems later on. Maybe at some point you thought that storing your data in a nested list was a good idea, but curse yourself when you try to draw a graph with that data. Because you don’t know the optimal form for your data when you start working with it, you can end up is some ugly places. The great thing about Tidy Data is that it gives you a really good set of first steps which will rarely lead you astray. No matter where your analysis goes, a nice tidy dataset will be your arrow against misfortune.</p>
<p>The first articulation of tidy data which I read was from this <a href="http://vita.had.co.nz/papers/tidy-data.pdf">Hadley Wickham paper</a>. A tidy dataset is one in which:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>I would add a fourth consideration:</p>
<ol start="4" style="list-style-type: decimal">
<li>The information is expressed as simply as practicable.</li>
</ol>
<p>This fourth consideration is really just a restatement of the other three, but it is still a very helpful way of thinking about your data which often reveals subtle problems. For instance you can ask whether you are duplicating information in your data sets and whether removing that duplication simplifies the data. Another common simplification is referring to information consistently for instance by changing all of the <code>Mon</code>’s to <code>Monday</code>’s.</p>
<p>Whenever I start a new data analysis I look at my data and ask whether it’s tidy, and if it’s not, I do the work splitting up strings, reshaping tables, and joining data sets together to get it into a tidy form. This often feels like a waste of time because you are not immediately providing analytical value, but it almost always pays off in the long run.</p>
<p>Tidying data is powerful both because it allows you to use all the great tidyverse packages, but also because it forces you to ask important questions about your data. To get each column to represent a variable you need to know what the variables are. Maybe the unit of observation is not obvious and you need more information about how the data is collected. Maybe you don’t really know how observations can go missing or how missing data is treated. Asking these questions right at the beginning of an analysis helps to clairify what you are trying to do and save time and mistakes down the road.</p>
</div>
<div id="convertr-example" class="section level3">
<h3>Convertr Example</h3>
<p>I wanted to provide an example of how data tidying can lead to faster, simpler code. My first foray into R package development was a unit converter called <a href="https://github.com/ropenscilabs/convertr">convertr</a> the idea behind this package was to allow users to convert between as many units as possible, and as a result I needed to pull together lots of different data sources into a common data structure. I needed all of the scientific units from one place, all of the engineering units from another, all of the medieval English units from another place etc. The first question then was, how do you store all of this data? What form should it take? One natural option is a conversion matrix:</p>
<pre class="r"><code>library(convertr)
library(tidyverse)

load(&quot;conversion_table.rda&quot;)

example_units &lt;- c(&quot;firkin&quot;, &quot;ton (water)&quot;, &quot;shotUS&quot;, &quot;pony&quot;, &quot;cu yd&quot;, &quot;load&quot;, 
&quot;cm3&quot;, &quot;m3&quot;, &quot;kilderkin&quot;, &quot;flozUK&quot;)

example_df &lt;- data_frame( unit = rep(example_units, 10),
                          to   = rep(example_units, each = 10))
example_df$factor &lt;- map2_dbl(example_df$unit, example_df$to, ~convert(1, .x, .y))
example_df &lt;- example_df %&gt;% 
  mutate(factor = round(factor, 4)) %&gt;% 
  spread(to, factor, NA)

DT::datatable(example_df, rownames = FALSE)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)"],[1,764555,40914.8,28.4,81829.6,1415840,1000000,22.2,44,1018320],[0,1,0.0535,0,0.107,1.8518,1.308,0,0.0001,1.3319],[0,18.6865,1,0.0007,2,34.6046,24.441,0.0005,0.0011,24.8888],[0.0352,26920.9507,1440.662,1,2881.3239,49853.5211,35211.2676,0.7817,1.5493,35856.338],[0,9.3433,0.5,0.0003,1,17.3023,12.2205,0.0003,0.0005,12.4444],[0,0.54,0.0289,0,0.0578,1,0.7063,0,0,0.7192],[0,0.7646,0.0409,0,0.0818,1.4158,1,0,0,1.0183],[0.045,34439.4144,1843.009,1.2793,3686.018,63776.5766,45045.045,1,1.982,45870.2703],[0.0227,17376.25,929.8818,0.6455,1859.7636,32178.1818,22727.2727,0.5045,1,23143.6364],[0,0.7508,0.0402,0,0.0804,1.3904,0.982,0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>unit<\/th>\n      <th>cm3<\/th>\n      <th>cu yd<\/th>\n      <th>firkin<\/th>\n      <th>flozUK<\/th>\n      <th>kilderkin<\/th>\n      <th>load<\/th>\n      <th>m3<\/th>\n      <th>pony<\/th>\n      <th>shotUS<\/th>\n      <th>ton (water)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>This table is great for printing out and looking up units by hand. If you wanted to convert firkins to kilderkins all you do is look up firkins in the column name and kilderkin in the row name and look for the conversion factor stored in the cell value. While intuitive, this dataset is not tidy because the observations do not form a row, and the variables are not stored in columns. For this problem the two variable are probably the unit that we are converting from, the unit we are converting to, and the conversion factor, so we want to transform this from its current wide format to a long format with only three columns. This is what the <code>tidyr</code> package is for.</p>
<pre class="r"><code>names(example_df)[1] &lt;- &quot;from_unit&quot;
example_df &lt;- example_df %&gt;% 
  gather(to_unit, factor, -from_unit)

DT::datatable(example_df, rownames = FALSE)</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)"],["cm3","cm3","cm3","cm3","cm3","cm3","cm3","cm3","cm3","cm3","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","firkin","firkin","firkin","firkin","firkin","firkin","firkin","firkin","firkin","firkin","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","load","load","load","load","load","load","load","load","load","load","m3","m3","m3","m3","m3","m3","m3","m3","m3","m3","pony","pony","pony","pony","pony","pony","pony","pony","pony","pony","shotUS","shotUS","shotUS","shotUS","shotUS","shotUS","shotUS","shotUS","shotUS","shotUS","ton (water)","ton (water)","ton (water)","ton (water)","ton (water)","ton (water)","ton (water)","ton (water)","ton (water)","ton (water)"],[1,764555,40914.8,28.4,81829.6,1415840,1000000,22.2,44,1018320,0,1,0.0535,0,0.107,1.8518,1.308,0,0.0001,1.3319,0,18.6865,1,0.0007,2,34.6046,24.441,0.0005,0.0011,24.8888,0.0352,26920.9507,1440.662,1,2881.3239,49853.5211,35211.2676,0.7817,1.5493,35856.338,0,9.3433,0.5,0.0003,1,17.3023,12.2205,0.0003,0.0005,12.4444,0,0.54,0.0289,0,0.0578,1,0.7063,0,0,0.7192,0,0.7646,0.0409,0,0.0818,1.4158,1,0,0,1.0183,0.045,34439.4144,1843.009,1.2793,3686.018,63776.5766,45045.045,1,1.982,45870.2703,0.0227,17376.25,929.8818,0.6455,1859.7636,32178.1818,22727.2727,0.5045,1,23143.6364,0,0.7508,0.0402,0,0.0804,1.3904,0.982,0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>from_unit<\/th>\n      <th>to_unit<\/th>\n      <th>factor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>This data is a little tidier but there’s still a ways to go. Now we have the variables in the column names, but each row is not an observation we can express the information more simply. The first thing you notice is that we have each conversion factor stored twice. We have one factor for converting cubic yards to cubic meters spoons, and one for converting cubic meters to cubic yards. Since unit conversion is symmetrical, we can use the one factor for both of those operations.</p>
<pre class="r"><code>example_df$key &lt;- map2(example_df$from_unit, example_df$to_unit, ~(c(.x, .y))) %&gt;% 
  map(~.[order(.)]) %&gt;% 
  map_chr(~paste(., collapse = &quot; &quot;))

example_df %&gt;% 
  group_by(key) %&gt;% 
  filter(row_number() == 1) %&gt;% 
  ungroup() %&gt;% 
  select(-key) %&gt;% 
  DT::datatable()</code></pre>
<div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55"],["cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)","kilderkin","load","m3","pony","shotUS","ton (water)","load","m3","pony","shotUS","ton (water)","m3","pony","shotUS","ton (water)","pony","shotUS","ton (water)","shotUS","ton (water)","ton (water)"],["cm3","cm3","cm3","cm3","cm3","cm3","cm3","cm3","cm3","cm3","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","cu yd","firkin","firkin","firkin","firkin","firkin","firkin","firkin","firkin","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","flozUK","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","kilderkin","load","load","load","load","load","m3","m3","m3","m3","pony","pony","pony","shotUS","shotUS","ton (water)"],[1,764555,40914.8,28.4,81829.6,1415840,1000000,22.2,44,1018320,1,0.0535,0,0.107,1.8518,1.308,0,0.0001,1.3319,1,0.0007,2,34.6046,24.441,0.0005,0.0011,24.8888,1,2881.3239,49853.5211,35211.2676,0.7817,1.5493,35856.338,1,17.3023,12.2205,0.0003,0.0005,12.4444,1,0.7063,0,0,0.7192,1,0,0,1.0183,1,1.982,45870.2703,1,23143.6364,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>from_unit<\/th>\n      <th>to_unit<\/th>\n      <th>factor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>We’ve moved from a list of a hundred factors to one with just 55. Each column represents a variable and each row represents an observation. This probably meets the basic definition of a tidy dataset but the information can still be expressed more simply.</p>
<p>How I usually think about this criteria is just to ask “If I were entering this data by hand, how could I save effort?” In this case that was easy because I was actually entering the data by hand, but it’s a useful heuristic in lots of cases. Another good question is “if I were storing this data in a database, how might I save storage space?” which pushes you to think about what information you care about, and the best way to store that information. In this case we can remember that every unit has an System Internationale (SI) unit which it can be converted to. This means that we can always convert two units by converting through the SI unit. If we wanted to convert firkins to kilderkins we could first convert firkins to cubic meters and then cubic meters to kildekins.</p>
<pre class="r"><code>example_df %&gt;%
  group_by(from_unit) %&gt;% 
  select(-to_unit) %&gt;% 
  filter(row_number() == 1) %&gt;% 
  mutate(base_unit = &quot;m3&quot;) %&gt;% 
  mutate(factor = map2_dbl(from_unit, base_unit, ~convert(1, .x, .y))) %&gt;% 
  select(from_unit, base_unit, factor) %&gt;% 
  DT::datatable(rownames = FALSE)</code></pre>
<div id="htmlwidget-4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"filter":"none","data":[["cm3","cu yd","firkin","flozUK","kilderkin","load","m3","pony","shotUS","ton (water)"],["m3","m3","m3","m3","m3","m3","m3","m3","m3","m3"],[1e-06,0.764555,0.0409148,2.84e-05,0.0818296,1.41584,1,2.22e-05,4.4e-05,1.01832]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>from_unit<\/th>\n      <th>base_unit<\/th>\n      <th>factor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Through this process we’ve gone from a matrix with 1000 cells, to a long dataframe with 100 rows, to one with 55 rows, and finally one with just 10 rows. Additionally we can figure whether two units can be converted to one another by just checking whether they have the same base unit.</p>
<p>In addition to creating an efficient data storage mechanism, this process creates clairity about how to solve the unit conversion problem. We know that we basically need two functions, one to convert units to their SI counterparts, and another one to convert from the base unit to the target unit.</p>
<p>This has been my experience with data tidying. Almost every time I tidy data I learn something crucial about how the data should be expressed, and about the problem which I’m trying to solve. This knowledge is invaluable throughout the data analysis process, and cleaning up the dataset is the best way to acquire it.</p>
</div>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/r_for_excel_users/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">R for Excel Users</span>
    </a>
    
    
    <a href="/posts/ui_data_analysis/" class="navigation-next">
      <span class="navigation-tittle">Data Visualization and UI design</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-98228149-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
